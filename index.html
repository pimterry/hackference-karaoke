<html>
<head>
<title>Hackference Karaoke</title>
</head>
<body>
<style>
#remote-media video {
  display: none;
}
</style>

<div id="tracks"></div>

<div id="remote-media"></div>

Room name:<input type="text" value="hackference" id="connect-to"></input>
<button id="connect">Connect</button>




<script type="text/javascript" src="//media.twiliocdn.com/sdk/rtc/js/conversations/v0.9/twilio-rtc-conversations.min.js"></script>
<script>
(function () {
var endpoint;

// check for WebRTC
if (!navigator.webkitGetUserMedia && !navigator.mozGetUserMedia) {
  alert('WebRTC is not available in your browser.');
}

// generate an access token in the Twilio Account Portal - https://www.twilio.com/user/account/video/testing-tools
window.accessToken = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsImN0eSI6InR3aWxpby1zYXQ7dj0xIn0.eyJqdGkiOiJTSzU5YzBiZGNjMzkyNjlhMDI0YWE5YzU5ODVlOTYxYjdlLTE0NDM4NzY5OTYiLCJpc3MiOiJTSzU5YzBiZGNjMzkyNjlhMDI0YWE5YzU5ODVlOTYxYjdlIiwic3ViIjoiQUM1MTIwZDBmODA2NTgzZTMxMTgxMmYxNDk4ZjYwMTIwNyIsIm5iZiI6MTQ0Mzg3Njk5NiwiZXhwIjoxNDQzOTYzMzk2LCJncmFudHMiOlt7InJlcyI6Imh0dHBzOlwvXC9hcGkudHdpbGlvLmNvbVwvMjAxMC0wNC0wMVwvQWNjb3VudHNcL0FDNTEyMGQwZjgwNjU4M2UzMTE4MTJmMTQ5OGY2MDEyMDdcL1Rva2Vucy5qc29uIiwiYWN0IjpbIlBPU1QiXX0seyJyZXMiOiJzaXA6aGFja2ZlcmVuY2VAQUM1MTIwZDBmODA2NTgzZTMxMTgxMmYxNDk4ZjYwMTIwNy5lbmRwb2ludC50d2lsaW8uY29tIiwiYWN0IjpbImxpc3RlbiIsImludml0ZSJdfV19.Hl4fkoDQAp5qMxC8invja9pCJO39L9yVDIAig3enbkc';

// create an Endpoint and connect to Twilio
endpoint = new Twilio.Endpoint(accessToken);
endpoint.listen().then(
  endpointConnected,
  function (error) {
    log('Could not connect to Twilio: ' + error.message);
  }
);

// successfully connected!
function endpointConnected() {
  log("Connected to Twilio. Listening for incoming Invites as '" + endpoint.address + "'");
};

// activity log
function log(message) {
  console.log(message);
};

endpoint.on('invite', function (invite) {
  log('Incoming invite from: ' + invite.from);
  invite.accept().then(conversationStarted);
});

function conversationStarted(conversation) {
  log("In an active Conversation");

  // when a participant joins, draw their video on screen
  conversation.on('participantConnected', function (participant) {
    log("Participant '" + participant.address + "' connected");
    participant.media.attach('#remote-media');
  });

  // when a participant disconnects, note in log
  conversation.on('participantDisconnected', function (participant) {
    log("Participant '" + participant.address + "' disconnected");
  });

  // when the conversation ends, stop capturing local video
  conversation.on('ended', function (conversation) {
    log("Connected to Twilio. Listening for incoming Invites as '" + endpoint.address + "'");
    conversation.localMedia.stop();
    conversation.disconnect();
  });
}

document.getElementById("connect").addEventListener('click', function () {
  var inviteTo = document.getElementById('connect-to').value;
  var options = {};
  endpoint.createConversation(inviteTo, options).then(
    conversationStarted,
    function (error) {
      log('Unable to create conversation');
      console.error('Unable to create conversation', error);
    }
  );
});

}());
</script>
	<script>
		function httpGetAlbumTRacks(albumUrl)
		{
		    var xmlHttp = new XMLHttpRequest();
		    xmlHttp.onreadystatechange = function() { 
		        if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
		        	var listHTML = document.createElement('ul');
		        	albumTracks = JSON.parse(xmlHttp.responseText);
					for (var item of albumTracks.tracks.items) {
						listHTML.innerHTML += '<li><a href="'+item.href+'" onclick="loadSpotifySong(this); return false;">'+item.name+'</a></li>';
					    document.getElementById('tracks').appendChild(listHTML);
					    songLinks = document.querySelectorAll('a');
					}
				}
		    }
		   	xmlHttp.open( "GET", albumUrl, false );
		    xmlHttp.send( null );
		}

		function loadSpotifySong(songHREF){
			console.log(songHREF);
		}


		var albumUrl = 'https://api.spotify.com/v1/albums/4wNYx6KOYSCRPOhZ0Z2vS1';
		var albumTracks = songlinks = '';

		httpGetAlbumTRacks(albumUrl);

	</script>
</body>
</html>
