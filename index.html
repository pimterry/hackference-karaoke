<html>
<head>
<title>Hackference Karaoke</title>
<script type="text/javascript" src="//media.twiliocdn.com/sdk/rtc/js/conversations/v0.9/twilio-rtc-conversations.min.js"></script>
<script>
(function () {
var endpoint;

// check for WebRTC
if (!navigator.webkitGetUserMedia && !navigator.mozGetUserMedia) {
  alert('WebRTC is not available in your browser.');
}

// generate an access token in the Twilio Account Portal - https://www.twilio.com/user/account/video/testing-tools
window.accessToken = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsImN0eSI6InR3aWxpby1zYXQ7dj0xIn0.eyJqdGkiOiJTSzU5YzBiZGNjMzkyNjlhMDI0YWE5YzU5ODVlOTYxYjdlLTE0NDM4NzQyNTkiLCJpc3MiOiJTSzU5YzBiZGNjMzkyNjlhMDI0YWE5YzU5ODVlOTYxYjdlIiwic3ViIjoiQUM1MTIwZDBmODA2NTgzZTMxMTgxMmYxNDk4ZjYwMTIwNyIsIm5iZiI6MTQ0Mzg3NDI1OSwiZXhwIjoxNDQzOTYwNjU5LCJncmFudHMiOlt7InJlcyI6Imh0dHBzOlwvXC9hcGkudHdpbGlvLmNvbVwvMjAxMC0wNC0wMVwvQWNjb3VudHNcL0FDNTEyMGQwZjgwNjU4M2UzMTE4MTJmMTQ5OGY2MDEyMDdcL1Rva2Vucy5qc29uIiwiYWN0IjpbIlBPU1QiXX0seyJyZXMiOiJzaXA6dGltQEFDNTEyMGQwZjgwNjU4M2UzMTE4MTJmMTQ5OGY2MDEyMDcuZW5kcG9pbnQudHdpbGlvLmNvbSIsImFjdCI6WyJsaXN0ZW4iLCJpbnZpdGUiXX1dfQ.K9T6hQhyqNkbCXWgB8DYQT3W2A9PDaPyFF2aCic9vuQ';

// create an Endpoint and connect to Twilio
endpoint = new Twilio.Endpoint(accessToken);
endpoint.listen().then(
  endpointConnected,
  function (error) {
    log('Could not connect to Twilio: ' + error.message);
  }
);

// successfully connected!
function endpointConnected() {
  //alert('Connected!');
  log("Connected to Twilio. Listening for incoming Invites as '" + endpoint.address + "'");
};

// activity log
function log(message) {
  console.log(message);
};}());
</script>
</head>
<body>
	<div id="tracks"></div>
	<script>
		function httpGetAlbumTRacks(albumUrl)
		{
		    var xmlHttp = new XMLHttpRequest();
		    xmlHttp.onreadystatechange = function() { 
		        if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
		        	var listHTML = document.createElement('ul');
		        	albumTracks = JSON.parse(xmlHttp.responseText);
					for (var item of albumTracks.tracks.items) {
						listHTML.innerHTML += '<li><a href="'+item.href+'" onclick="loadSpotifySong(this); return false;">'+item.name+'</a></li>';
					    document.getElementById('tracks').appendChild(listHTML);
					    songLinks = document.querySelectorAll('a');
					}
				}
		    }
		   	xmlHttp.open( "GET", albumUrl, false );
		    xmlHttp.send( null );
		}

		function loadSpotifySong(songHREF){
			console.log(songHREF);
		}


		var albumUrl = 'https://api.spotify.com/v1/albums/4wNYx6KOYSCRPOhZ0Z2vS1';
		var albumTracks = songlinks = '';

		httpGetAlbumTRacks(albumUrl);

	</script>
</body>
</html>
